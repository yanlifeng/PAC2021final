# PAC2021 final -- ChiFanBuZhangRou

TODOs

- [x] Add rabbitio
- [x] Use other map
- [ ] Parallel in load map
- [ ] Use secondary index
- [x] Use list-hash
- [ ] Use aili-code ï¼Ÿï¼Ÿï¼Ÿ
- [ ] Optimize match algorithm
- [ ] Use gcc7 / gcc11
- [x] Use icc
- [x] Add pugz
- [ ] Read se not pe
- [x] Use parallel zip when write
- [ ] Check todos ğŸ‘‡ï¼ˆ//TODOï¼‰
- [x] Why write .fq.gz size diff ?
- [ ] Write fq in order?
- [x] queue1 more bigger (128x128 -> 128x1024)
- [ ] change block size in pugz(32kb -> 4mb)
- [x] change block size in pigz
- [ ] change queue1 to dataPool to decrease new and delete operations
- [ ] fix pigzWrite bug
- [ ] mod all barcode to 1e9, use it dirctely, cal time
- [x] test Gâ€˜s map
- [ ] test 0 3 6 9
- [x] merge mip write part
- [ ] checkğŸ‘†
- [x] add bloom filter
- [ ] 

## 0908

æ·¦ä¹‹å‰å†™çš„infoæ•´ä¸è§äº†ï¼Œéº»äº†ã€‚

| version                                               | total  | hdf5  | others |      |      |
| ----------------------------------------------------- | ------ | ----- | ------ | ---- | ---- |
| init                                                  | ï½1100 | ï½100 | ï½1000 |      |      |
| add rabbitio from rabbitqc                            | 750    | 100   | 650    |      |      |
| no gz                                                 | 386    | 100   | 286    |      |      |
| no gz && replace std::unordered_map to robin_hood::xx | 220    | 50    | 170    |      |      |
| no gz && use list hash                                | 179    | 28    | 151    |      |      |
| use list hash                                         | 500    | 29    | 191+x  |      |      |

//TODO ä¸ºäº†è¿‡ç¼–è¯‘æŠŠboostéƒ¨åˆ†æ¶‰åŠåˆ°mapçš„æ“ä½œåšäº†å¤åˆ¶ï¼Œè¿˜æœ‰ææ„çš„æ—¶å€™swapéƒ½æ³¨é‡Šæ‰äº†

## 0909

ç›®å‰å…ˆæææ¶ˆè´¹è€…å§ï¼Œå…ˆä¸æ•´gzï¼Œè®©è¯»å’Œå†™çº¿ç¨‹ä¸ä¼šæ˜¯ç“¶é¢ˆã€‚ä¸Šé¢æ˜¯ç®€å•æŠŠmapæ¢äº†ï¼Œæ¢å‰åéƒ½èƒ½æ‹‰èµ·æ¥64çº¿ç¨‹ï¼Œè¯´æ˜æ¶ˆè´¹è€…è¿˜æœ‰æå‡ç©ºé—´ï¼Œä»Šå¤©å‡†å¤‡è¯•è¯•é“¾å¼hashï¼Œæ„Ÿè§‰æ€è·¯å’Œä¸»åŠæ–¹ç»™çš„äºŒçº§ç´¢å¼•åº”è¯¥å·®ä¸å¤šã€‚

ç¡®å®æœ‰ç‚¹å­æå‡ï¼Œä½†æ˜¯æ²¡æœ‰ç‰¹åˆ«å¿«ï¼Œæ›´æ–°ğŸ‘†ã€‚

å†™çš„æ—¶å€™æœ‰ç‚¹å­å°å°çš„bugï¼ŒåŸºç¡€ä¸ç‰¢åœ°åŠ¨å±±æ‘‡å•Šï¼Œæœ¬æ¥ä»¥ä¸ºä¼ æŒ‡é’ˆè¿›å»å°±ä¸ç”¨&äº†ï¼Œä½†ä¹‹å‰çš„ç”¨æ³•éƒ½æ˜¯ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„ç©ºé—´é‡Œé¢çš„ä¿¡æ¯ï¼Œè¿™å¯ä»¥ä¸ç”¨&ï¼Œä½†æ˜¯ä»Šå¤©å±äºæ˜¯ç›´æ¥è¯¥æŒ‡é’ˆçš„å€¼äº†ã€‚

## 0910

å¥½åƒå¬è¯´å¹¶è¡Œæ–‡ä»¶ç³»ç»Ÿæ¯æ¬¡å†™æ³¢åŠ¨å¤ªå¤§ï¼Œå¼€æ”¾äº†è®¡ç®—èŠ‚ç‚¹ä¸Šçš„userç›®å½•ï¼Œè¿™é‡Œç®€å•æµ‹æµ‹å¯¹æˆ‘ä»¬æœ‰æ²¡æœ‰å½±å“ï¼š

|                                                       |                 |
| ----------------------------------------------------- | --------------- |
| Use list hash                                         | 499+500+510+500 |
| no gz ğŸ‘†                                               | 193+189+191     |
| no gz icpc  -Ofast -xHost -qopt-zmm-usage=high        | 192             |
| no gz g++  -Ofast -funroll-loops -flto  -march=native | 186+188         |
| gz   g++  -Ofast -funroll-loops -flto  -march=native  | 530+544         |

ç›®å‰è¯»å†™gzå¤§çº¦åªèƒ½ç”¨èµ·30ä¸ªæ ¸å¿ƒï¼Œæ¯”èµ·ä¹‹å‰çš„50ä¸ªæ ¸å¿ƒæœ‰äº†ä¸€å®šçš„æå‡ã€‚

ç®€å•æ¢ä¸€ä¸ªgccç‰ˆæœ¬å’Œicpcè¯•è¯•ï¼Œä½†æ˜¯ç¼–è¯‘çš„æ—¶å€™æŠ¥é”™äº†ï¼Œåˆæ­¥çŒœæµ‹æ˜¯ç¼–è¯‘å¥½çš„hdf5å’Œbooståº“æ˜¯ç”¨çš„gcc4ï¼Œç›¸å·®å¤ªå¤šä¸èƒ½ç”¨ï¼Œç”¨gcc7é‡æ–°æä¸€ä»½ã€‚

## 0911

æ²¡å•¥ç”¨å•Šï¼Œç”¨gcc7ç¼–è¯‘çš„boostè¿˜æ˜¯æŠ¥é”™ï¼Œå¹¶ä¸”æ‰¾äº†ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¹Ÿè¿˜æ˜¯æŠ¥é”™ï¼Œç›®å‰çŒœæµ‹å°±æ˜¯gcc7å’Œgcc11è‡ªå·±å®‰è£…çš„æ—¶å€™å°‘äº†ä»€ä¹ˆæ­¥éª¤ã€‚ç°åœ¨çš„å†…å­˜ä½¿ç”¨å¤§çº¦æ˜¯list hash mapå°±ç”¨äº†10.5Gå·¦å³ï¼Œç„¶ååé¢æ•´ä¸ªæ¶ˆè´¹è€…ä»¬åœ¨ç”¨3Gå·¦å³ï¼Œå¦‚æœå†™gzçš„è¯ä¼šæ¥ä¸åŠå‹ç¼©å¯¼è‡´ç§¯å‹åœ¨å†…å­˜é‡Œï¼Œèƒ½åˆ°20Gä»¥ä¸Šã€‚

ç®€å•æ¢äº†ä¸€ä¸‹ç¼–è¯‘å™¨å’Œç¼–è¯‘å‚æ•°ï¼ŒupdateğŸ‘†ã€‚

å¤šå¤šå°‘å°‘æœ‰ç‚¹ç”¨å§å¯èƒ½ã€‚

ä»Šå¤©è¿™æœºå™¨ä¸å¤§è¡Œå•Šã€‚

cï¼Œzzåˆ«å¼€ç®±å­äº†å¯ã€‚

## 0912

ä»Šå¤©çœ‹äº†çœ‹pugzï¼Œå…·ä½“åŸç†emmmè®ºæ–‡å¤ªé•¿äº†å±å®æ˜¯è¯»ä¸ä¸‹å»ï¼Œæ”¹å¤©å»å›¾ä¹¦é¦†æ…¢æ…¢çœ‹å§ã€‚

ç¨å¾®ä¿®æ”¹äº†ä»£ç ï¼Œå¥½åƒå¤šçº¿ç¨‹ç°åœ¨å°±æ˜¯æµå¼å¤„ç†çš„ï¼Ÿï¼Ÿï¼ŸæŠŠåŸæ¥wite to stdoutæ”¹æˆäº†to fileï¼Œå»shmä¸‹ç®€å•æµ‹äº†æµ‹æ€§èƒ½ï¼ŒåŸºæœ¬ä¸Š8çº¿ç¨‹èƒ½åˆ°30sä»¥ä¸‹ï¼Œéå¸¸ä¸é”™ç¬¦åˆèµ›é¢˜çš„è¦æ±‚ï¼Œç°åœ¨å†æµ‹æµ‹ç›´æ¥æŠŠ20Gçš„ç©æ„æ•´åˆ°å†…å­˜é‡Œçœ‹çœ‹å’‹æ ·ã€‚

## 0913

æ„Ÿè§‰pugzä¹Ÿä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æµå¼å¤„ç†ï¼Œç®€å•åŠ åˆ°äº†å†³èµ›é¢˜é‡Œé¢

|                                      | Total |      |
| ------------------------------------ | ----- | ---- |
| add pugz (one thread), in gz, out fq | 187   |      |
| Submit4, in gz, out fq               | 216   |      |
|                                      |       |      |

å•çº¿ç¨‹çš„è¯è¦æ¯”æ™®é€šçš„è§£å‹ç¼©å¥½ä¸€ç‚¹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç›´æ¥pugzå•çº¿ç¨‹å’Œgunzipé‚£æ ·æ˜æ˜¾ï¼Œè€Œä¸”ç°åœ¨å¤šçº¿ç¨‹ä¼šå‡ºç°é”™è¯¯ï¼Œå³è§£å‹å‡ºæ¥çš„ä¸¤å—å¤§å°è™½ç„¶ä¸€æ ·ä½†æ˜¯é‡Œé¢çš„å›è½¦ä¸ä¸€æ ·å¤šã€‚ã€‚ã€‚ã€‚

## 0914

giao

ConcurrentQueueä¸æ˜¯æœ‰åºçš„ï¼Œéº»äº†ã€‚æ¢æˆäº†åŒä¸€ä¸ªäººæå¾—ReaderWriterQueueï¼Œä¸€å¯¹ä¸€ï¼Œç°åœ¨èƒ½è¿‡checkäº†ï¼Œç®€å•æµ‹è¯•ä¸€ä¸‹ï¼š

|                           | insert | pugz1/pugz2/producer/consumer/total | run use number of consumer             |      |
| ------------------------- | ------ | ----------------------------------- | -------------------------------------- | ---- |
| init in gz out fq         | 24     | x/x/189/190/214                     | <30 ~28                                |      |
| pugz thread1 in gz out fq | 23     | 140/140/158/160/190                 | ä¸ç¨³å®šï¼Œæœ‰æ—¶å€™èƒ½åˆ°30å¤šï¼Œå¤§éƒ¨åˆ†æ—¶é—´50å¤š |      |
| pugz thread2 in gz out fq | 27     | 130/140/160/170/190                 | ğŸ‘†                                      |      |
|                           |        |                                     |                                        |      |
|                           |        |                                     |                                        |      |
|                           |        |                                     |                                        |      |
|                           |        |                                     |                                        |      |

æ„Ÿè§‰æ•ˆæœä¸€èˆ¬å•Šï¼Œè€Œä¸”è¿è¡Œä»–ç»™çš„gzæ–‡ä»¶è¿˜è€æ˜¯å‡ºé”™ã€‚ã€‚ã€‚ã€‚è‡ªå·±é‡æ–°å‹ç¼©äº†ä¸¤ä¸ªgzï¼ˆä¸€ä¸ªè¦åŠå°æ—¶ï¼Œï¼Œï¼Œï¼Œæ·¦ï¼‰

|                               | pugz1/pugz2/producer/consumer/total |      |
| ----------------------------- | ----------------------------------- | ---- |
| no process gz in no outï¼Œinit | x/x/185/190/210                     |      |
| ğŸ‘†ï¼Œpugz thread 1              | 46/50/46/50/75                      |      |
| ğŸ‘†ï¼Œpugz thread 2              | 35/37/35/37/62                      |      |
| ğŸ‘†ï¼Œpugz thread 4              | 30/33/52/53/78                      |      |
| ğŸ‘†ï¼Œpugz thread 8              | 31/30/56/59/84                      |      |

è™½ç„¶ä¸¤ä¸ªçº¿ç¨‹æœ€å¥½æœ‰ç‚¹å­å¥‡æ€ªï¼Œä½†æ˜¯åŸºæœ¬ä¸Šæ—¶é—´è¿˜æ¯”è¾ƒåˆç†ï¼Œä½†æ˜¯ä¸åŠ no processçš„è¯è¦è·‘100+sï¼Œä¸å¤ªåˆç†ã€‚

## 0915

|                                   |      |            | producer   | consumer | total |
| --------------------------------- | ---- | ---------- | ---------- | -------- | ----- |
| in gzï¼Œout fq                     | 12G  | ï½3500%    | 187        | 190      | 214   |
| pugz thread2ğŸ‘†                     | 35G  | >6000%     | 153(100)   | 160      | 190   |
| pugz thread4ğŸ‘†                     | x    | ä¸ç¨³å®šã€‚ã€‚ | x          | x        | x     |
| dataPool 1024,dataQueue 2048 init | 13G  | ï½3000%    | 189        | 190      | 218   |
| pugz thread2ğŸ‘†                     | 30G  | ä¸ç¨³å®š     | 150        | 180      | 204   |
| in fqï¼Œout fq                     | 17G  | ï½6400%    | 144        | 160      | 188   |
| real data init                    | 12G  | ï½3500%    | 189        | 190      | 218   |
| real data 128/500 pugz thread2    | <30G | ï½6000%    | 157ï¼ˆ120ï¼‰ | 160      | 190   |
|                                   |      |            |            |          |       |

æŠŠdataPoolå’ŒdataQueueå¼„å¤§äº†ä¹Ÿæ²¡å•¥ç”¨ã€‚

è¡¨é‡Œé¢çš„ç”Ÿäº§è€…æ—¶é—´å…¶å®ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„å‚è€ƒä»·å€¼ï¼Œå› ä¸ºå¯èƒ½æ¶ˆè´¹è€…å¤ªæ…¢æŠŠdataQueueå µä½äº†ï¼Œç”Ÿäº§è€…åœ¨ç­‰å¾…ï¼›å¯ä»¥å‘ç°initè¯»gzçš„æ—¶å€™På’ŒCçš„æ—¶é—´åŸºæœ¬ä¸€æ ·ï¼Œè¿™é‡Œåº”è¯¥æ˜¯Cåœ¨ç­‰Pï¼ŒPæå‡ºæ¥æœ€åä¸€å—æ•°æ®Cå¤„ç†å®Œå°±éƒ½ç»“æŸäº†ï¼Œè€Œè¯»fqæˆ–è€…pugzçš„è¯På’ŒCçš„æ—¶é—´æœ‰ä¸€ç‚¹å·®è·ï¼Œåº”è¯¥æ˜¯Cå¤ªæ…¢ï¼Œqueueæ»¡äº†ï¼ŒPä¸­é—´ç­‰å¾…äº†ï¼Œæœ€åPæå®Œé˜Ÿåˆ—é‡Œè¿˜æœ‰äº›æ•°æ®ï¼Œç„¶åCå¤„ç†å®Œã€‚



## 0916

æœ€è¿‘ä»Šå¤©å±äºæ˜¯è„‘å­ä¸å¤ªæ¸…é†’ï¼Œæ•´ä¸æ˜ç™½ä¸ºå•¥æ¶ˆè´¹è€…å¤šç”¨äº†æ¥è¿‘ä¸€å€ä½†æ˜¯æ—¶é—´æ²¡å’‹å˜ï¼Ÿ

ä»Šå¤©å…ˆèµ¶èµ¶è¿›åº¦ï¼ŒæŠŠbgzipåŠ ä¸Šï¼Œè¦ä¸å‹ç¼©å¤ªæ…¢äº†ï¼Œæ˜¨å¤©åœ¨fatä¸Šè¯•äº†è¯•ï¼Œbgzipå‹ç¼©å‡ºæ¥çš„gzæ–‡ä»¶gunzipæ˜¯å¯ä»¥è¯»çš„ï¼Œä½†æ˜¯pugzä¸æ”¯æŒã€‚

ä¸‹é¢æµ‹è¯•ä¸€ä¸‹ï¼Œè¾“å‡ºåˆ°/dev/shm

| Unzip           | p1.fq |      |
| --------------- | ----- | ---- |
| unpigz thread 1 | 83    |      |
| unpigz thread 2 | 66    |      |
| unpigz thread 4 | 66    |      |
| unpigz thread 8 | 66    |      |
| pugz thread 1   | 59    |      |
| pugz thread 2   | 40    |      |
| pugz thread 4   | 27    |      |
| gunzip          | 150   |      |

| Zip               | p1.fq  |      |
| ----------------- | ------ | ---- |
| pigz thread 1     | >1800  |      |
| pigz thread 2     | ï½1000 |      |
| pigz thread 4     | ï½500  |      |
| pigz thread 8     | ï½250  |      |
| gzip              | ~1800  |      |
| bgzip thread 1 -1 | 400    |      |
| bgzip thread 2 -1 | 200    |      |
| bgzip thread 4 -1 | 100    |      |
| bgzip thread 8 -1 | 52     |      |
|                   |        |      |
|                   |        |      |
| pigz thread 1 -4  | 420    |      |
| pigz thread 2 -4  | 210    |      |
| pigz thread 4 -4  | 105    |      |
| pigz thread 8 -4  | 53     |      |
| gzip -4           | 450ï½  |      |
| bgzip thread 1 -4 | 240    |      |
| bgzip thread 2 -4 | 120    |      |
| bgzip thread 4 -4 | 60     |      |
| bgzip thread 8 -4 | 32     |      |
|                   |        |      |
|                   |        |      |

æœ‰ç‚¹å¥‡æ€ªä¸ºå•¥ä»£ç é‡Œé¢çš„gzwriteå‹ç¼©èµ·æ¥é‚£ä¹ˆå¿«ï¼Ÿ

## 0917

æ·¦ï¼Œä»£ç é‡Œé¢æ˜¯-4ï¼Œåªå°±ç”¨gzipæˆ–è€…pigz -4ä¹Ÿå¾ˆå¿«ï¼Œè€Œä¸”ç®€å•æµ‹è¯•ä¹‹åå‘ç°pigzçš„çº¿ç¨‹åŠ é€Ÿæ¯”è¿˜æ˜¯æŒºå¥½çš„ï¼›è€Œbgzipä½œä¸ºåˆ†å—å‹ç¼©ä¼¼ä¹æ¯”pigzæ•ˆæœæ›´å¥½ï¼Œä½†æ˜¯pugzæ²¡æ³•å¤„ç†bgzipå‹ç¼©å‡ºæ¥çš„gzæ–‡ä»¶ï¼Œpugzå¯ä»¥ç”¨ä¸¤ä¸ªçº¿ç¨‹å¤„ç†pigzå‹ç¼©å‡ºæ¥çš„æ–‡ä»¶ï¼ˆ//TODO çº¿ç¨‹æ•°å¤šçš„æ—¶å€™å¯èƒ½ä¼šæŠ¥é”™ï¼‰ã€‚

ç»¼ä¸Šï¼Œç»¼åˆè€ƒè™‘é€Ÿåº¦å¯æ˜“ç”¨æ€§ï¼Œå‡†å¤‡ä½¿ç”¨pugzè¿›è¡Œå¤šçº¿ç¨‹çš„è§£å‹ç¼©ï¼ˆè¿™ä¸ªå¯ä»¥æ­£å¸¸å¤„ç†gzipå‹ç¼©å‡ºæ¥çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸¤ä¸ªçº¿ç¨‹//TODOå¤„ç†pigzå‹ç¼©å‡ºæ¥çš„æ–‡ä»¶ï¼Œä½†æ˜¯æ— æ³•å¤„ç†bgzipå‹ç¼©å‡ºæ¥çš„æ–‡ä»¶---åªä¼šè§£å‹ç¬¬ä¸€å—ï¼‰ï¼Œç„¶åä½¿ç”¨pigzè¿›è¡Œå‹ç¼©ï¼ˆè¿™æ ·å‹ç¼©å‡ºæ¥çš„æ–‡ä»¶åˆ°ä¸‹ä¸€ä¸ªæµç¨‹ä½¿ç”¨æ™®é€šçš„gunzipå®Œå…¨å¯ä»¥ï¼Œä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„ä»£ç å¼€ä¸¤ä¸ªçº¿ç¨‹è¯»ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰ã€‚

## 0918

è§£å°äº†èŠœæ¹–

|                             |      |         |            |      |      |
| --------------------------- | ---- | ------- | ---------- | ---- | ---- |
| in gz                       | 12G  | ï½3500% | 189        | 190  | 218  |
| in gzï¼Œpugz thread 2        | <30G | ï½6000% | 157ï¼ˆ120ï¼‰ | 160  | 190  |
| /users in gz                | 12G  | ï½3500% | 190        | 190  | 219  |
| /users in gzï¼Œpugz thread 2 | <30G | ï½6000% | 157ï¼ˆ120ï¼‰ | 160  | 190  |
| /users in gzï¼Œpugz thread 1 | <30G | >6000%  | 151ï¼ˆ120ï¼‰ | 160  | 183  |
| /users in fq                |      |         |            |      |      |

ç»™pugzå’Œproducerä¹‹é—´çš„queueåŠ ä¸ªå¤§å°é™åˆ¶å§ã€‚

æ·¦ å¥½åƒæ­»é”äº†ã€‚ã€‚ã€‚ã€‚

## 0919

æœªæ›¾è®¾æƒ³è¿‡çš„é”™è¯¯ï¼Œï¼Œï¼Œï¼Œsleepå•ä½å±…ç„¶æ˜¯sï¼Œæˆ‘æ€ä¹ˆè®°å¾—ä¹‹å‰ç”¨çš„éƒ½æ˜¯mså•Šã€‚ã€‚ã€‚ç„¶åé˜Ÿåˆ—1æ»¡äº†çš„æ—¶å€™pugzçº¿ç¨‹å°±å¼€å§‹äº†é•¿è¾¾1000sçš„æ²‰ç¡ã€‚ã€‚ã€‚ã€‚

æ”¹æˆusleepä¹‹åæœ‰åŠ äº†ä¸ªproducerç»“æŸçš„tagï¼Œå¦‚æœproducerç»“æŸäº†pugzçº¿ç¨‹å°±åœæ­¢è§£å‹äº†ã€‚

|                                             |      |                  |                 |      |      |
| ------------------------------------------- | ---- | ---------------- | --------------- | ---- | ---- |
| in gzï¼Œpugz thread 2ï¼Œqueue 128*128         | <18G | ï½6000%          | 157ï¼ˆ150ï¼Œ157ï¼‰ | 160  | 192  |
| in gzï¼Œpugz thread 1ï¼Œqueue 128*128         | <18G | ï½6000%          | 157ï¼ˆ150ï¼Œ157ï¼‰ | 160  | 192  |
| get map and pugz same time thread 1         | <18G | >6000%           | 180 180 180     | 180  | 187  |
| get map and pugz same time thread 1         | <18G | >6000%           | 180 180 190     | 190  | 197  |
| queue1ï¼š1<<20ï¼Œin gzï¼Œout gzï¼Œpugz thread 1 | ~60G | 6400->5000->6400 | 186 89 94       | 189  | 191  |

å‘ç°å¼€å§‹çš„å‡ ç§’ä¼¼ä¹çº¿ç¨‹éƒ½ç”¨ä¸èµ·æ¥ï¼Œåº”è¯¥æ˜¯Påœ¨ç­‰pugzï¼Œè¿™å—æ—¶é—´å¯ä»¥å…ˆç®€å•çš„å’Œhashmap insertæ”¾åˆ°ä¸€å—ï¼Œåæ­£äº’ä¸å½±å“ã€‚

//TODO æŠŠqueue1å¼€çš„å¤§ä¸€ç‚¹æ–¹ä¾¿ä¸€å¼€å§‹æ©ç›–pugzçš„æ—¶å€™èƒ½é¢„å¤„ç†å‡ºæ›´å¤šçš„å—ã€‚

//TODO ä¿®æ”¹pugzæ¯ä¸€å—çš„å¤§å°

//TODO ç»™queue1æ”¹æˆä¸€ä¸ªå†…å­˜æ± ï¼Œå‡å°‘newå’Œdelete

å¥½å•Šï¼ŒåŸºæœ¬ä¸Šç”Ÿäº§è€…ä»¬æå¾—å¤§ä½“å·®ä¸å¤šäº†ï¼ˆPå’Œpugzï¼‰ï¼Œç°åœ¨æä¸€ä¸‹writeã€‚

|                                             |      |              |             |      |      |
| ------------------------------------------- | ---- | ------------ | ----------- | ---- | ---- |
| ğŸ‘† pugz thread 1ï¼Œin gzï¼Œout gz              | 30G  | 4000%ï½5000% | 204 200 210 | 210  | 566  |
| ğŸ‘† pugz thread 2ï¼Œin gzï¼Œout gz              | 30G  | 4000%ï½5000% | 204 200 210 | 210  | 566  |
| queue1ï¼š1<<20ï¼Œin gzï¼Œout gzï¼Œpugz thread 1 | <60G | ï½5000%      | 197 90 90   | 198  | 530  |
| queue1ï¼š1<<20ï¼Œin gzï¼Œout gzï¼Œpugz thread 2 | <60G | ï½6000%      | 194 57 62   | 195  | 538  |
|                                             |      |              |             |      |      |
|                                             |      |              |             |      |      |

## 0920

ç®€å•çœ‹äº†çœ‹pigzçš„æ–‡æ¡£ï¼Œæ²¡æœ‰apiä½†æ˜¯stack overflowé‡Œé¢æœ‰ä¸€ä¸ªpigzçš„å¼€å‘è€…å›ç­”çš„é—®é¢˜ï¼Œè¯´æ˜¯è¦æ”¯æŒpipeï¼Œçœ‹æ›´æ–°æ—¥å¿—å¤§çº¦å›ç­”è¿™ä¸ªé—®é¢˜ä¸¤ä¸ªæœˆä¹‹åpigzçœŸçš„åŠ äº†è¿™å—åŠŸèƒ½ï¼Œä½†æ˜¯ç¨å¾®çœ‹äº†çœ‹å‚æ•°æ²¡æ‰¾åˆ°å’‹ç”¨ã€‚ã€‚ã€‚è¿˜æ˜¯ç›´æ¥æ”¹ä»£ç å§ã€‚

æŠŠpigzåŠ åˆ°å†³èµ›çš„ä»£ç é‡Œï¼ˆç›´æ¥æŠŠpigz.cå¤åˆ¶åˆ°multi.cppé‡Œé¢çš„ï¼Œå¾ˆä¸‘é™‹ã€‚ã€‚ã€‚ã€‚ç„¶åæ”¹äº†yarn.hä¸­çš„å…³é”®å­—ï¼Œç„¶åæŠŠ.hæ–‡ä»¶éƒ½åŠ äº†extren Cï¼ŒæŠŠcomliain(x,...)ç»™æ³¨é‡Šäº†ï¼Œå‹‰å¼ºå¯ä»¥è¿è¡Œäº†ï¼‰

ç°åœ¨ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œå…ˆç”¨åŸæ¥çš„writeæŠŠfqå†™åˆ°ç¡¬ç›˜ä¸Šï¼Œå†ç”¨å¼€ä¸ªçº¿ç¨‹ç”¨pigzå‹ç¼©ã€‚

|                                                   |               |               |           |         |      |
| ------------------------------------------------- | ------------- | ------------- | --------- | ------- | ---- |
| add pigz thread 2ï¼Œin gzï¼Œout gzï¼Œpugz thread 1ğŸ‘†  | <60G          | ï½5000%/6400% | 193 90 95 | 196+242 | 443  |
| add pigz thread 16ï¼Œin gzï¼Œout gzï¼Œpugz thread 1ğŸ‘† | <60G          | ï½6000%/6400% | 191 90 95 | 195+47  | 244  |
| add pigz thread 32ï¼Œin gzï¼Œout gzï¼Œpugz thread 2ğŸ‘† | <60Gï¼ˆï½50Gï¼‰ | ï½6000%/6400% | 191 55 59 | 195+39  | 238  |
| add pigz thread 64ï¼Œin gzï¼Œout gzï¼Œpugz thread 2ğŸ‘† | <60Gï¼ˆï½50Gï¼‰ | ï½6000%/6400% | 184 55 59 | 188+30  | 219  |

## 0921 

```
rm -rf combine_read.fq && rm -rf combine_read.fq.gz && ../ST_BarcodeMap-0.0.1 --in DP8400016231TR_D1.barcodeToPos.h5 --in1 V300091300_L03_read_1.fq.gz  --in2 V300091300_L04_read_1.fq.gz --out combine_read.fq --mismatch 2 --thread 64 --usePugz --pugzThread 2 --usePigz --pigzThread 32
```

```c++
		int th_num = mOptions->pigzThread;
    printf("th num is %d\n", th_num);
    string th_num_s = to_string(th_num);
    printf("th num s is %s\n", th_num_s.c_str());
    printf("th num s len is %d\n", th_num_s.length());

    infos[2] = new char[th_num_s.length() + 1];
    memcpy(infos[2], th_num_s.c_str(), th_num_s.length());
```

è¿™æ®µä»£ç å¥½åƒemmmï¼Œchar*åé¢æ‰¾ä¸åˆ°ç»“æŸç¬¦ï¼Œç”¨çš„æ—¶å€™å°±å¯èƒ½å‡ºé—®é¢˜ï¼Œç°åœ¨çš„ç­–ç•¥æ˜¯å†åŠ ä¸€å¥

```c++
infos[2][th_num_s.length()] = '\0';
```

æ„Ÿè§‰ä¸å¤ªä¼˜é›…ã€‚

update table ğŸ‘†

## 0922

åŸæ¥çš„pigzä»£ç é‡ŒåŒ…æ‹¬äº†è¾“å…¥æ–‡ä»¶xx.fqæ˜¯å¦å­˜åœ¨çš„æ£€æŸ¥ï¼Œç°åœ¨åªèƒ½æ˜¯æŠŠoutå‚æ•°çš„xx.fq.gzæ”¹æˆxx.fqï¼Œç”¨æºä»£ç writerçš„new ofstreamç”Ÿæˆä¸€ä¸ªç©ºçš„xx.fqæ¬ºéª—ä¸€ä¸‹pigzï¼ˆ5000è¡Œä»£ç æ˜¯åœ¨ä¸æƒ³åŠ¨ï¼‰ã€‚

ç„¶åç°åœ¨åœ¨writerå’Œpigzä¹‹é—´åŠ äº†ä¸€ä¸ªqueueï¼Œå¤§å°è¿˜æ˜¯1<<20ï¼ŒæŠŠpigzçš„å—å¤§å°æ”¹æˆäº†4Mã€‚

|                                             |      |               | producer(pugz) | comsumer(pigz) | total |
| ------------------------------------------- | ---- | ------------- | -------------- | -------------- | ----- |
| no more disk write and readï¼Œpugz 2ï¼Œpigz 4 | ~60G | ï½5000%/6400% | 195 61 66      | 198 201        | 201   |
| no more disk write and readï¼Œpugz 2ï¼Œpigz 2 | ~60G | ï½5000%/6400% | 193 62 67      | 194 283        | 294   |
| no more disk write and readï¼Œpugz 1ï¼Œpigz 4 | ~60G | ï½5000%/6400% | 183 95 100     | 187 189        | 190   |
| ğŸ‘†pigz block size 8Mï¼Œpugz 1ï¼Œpigz 4         | ~60G | ï½5000%/6400% |                |                | 203   |

è¿™ä¸ªæµ‹å¾—æ—¶é—´æœ‰ç‚¹å­æ³¢åŠ¨ã€‚ã€‚ã€‚ç®—äº†å…ˆä¸ç®¡äº†ï¼Œåæ­£å¤§ä½“ä¸Šï¼Œå•ç‹¬æµ‹è¯•çš„è¯å‹ç¼©å’Œè§£å‹ç¼©å¤§çº¦30så·¦å³ï¼Œåœ¨ç¨‹åºé‡Œæµ‹è¯•çš„è¯å‹ç¼©å¤§çº¦60sï¼Œè§£å‹ç¼©16ä¸ªçº¿ç¨‹ä¹Ÿèƒ½60sä»¥å†…ï¼Œä½†æ˜¯ç°åœ¨æ¶ˆè´¹è€…è€—æ—¶è¿œé«˜äº60sï¼Œå¯ä»¥å…ˆæŠŠé‡ç‚¹è½¬ç§»åˆ°æ¶ˆè´¹è€…ä¸Šäº†ã€‚

ç®€å•åˆ†æäº†ç°åœ¨çš„hash mapï¼Œä¸€å…±2.6e8ä¸ªå…ƒç´ ï¼Œmodæ˜¯1e9+7ï¼Œæœ‰2e8ä¸ªæ˜¯ä¸å†²çªçš„ï¼Œæ‰€ä»¥modå–è¿™ä¹ˆå¤§çš„æƒ…å†µä¸‹å¹¶ä¸éœ€è¦åœ¨é“¾è¡¨è¿™é‡Œåšä»€ä¹ˆæ“ä½œã€‚ä½†æ˜¯åŒæ ·çš„ï¼Œå†…å­˜éœ€æ±‚ä¹Ÿæ˜¯å¾ˆå¤§çš„ï¼Œç›´æ¥çš„hashè¡¨å¤§çº¦å 3Gï¼Œåé¢é“¾è¡¨å­˜å‚¨çš„2.6e8ä¸ªint64å¤§çº¦å 4Gã€‚

æ¢å‡ ä¸ªmodè¯•è¯•ï¼šï¼ˆç®€å•çš„è¯»fqå†™fqï¼‰

|            |       |       | get map |         |      |
| ---------- | ----- | ----- | ------- | ------- | ---- |
| 1e9+7      | ï½12G | 6400% | 27      | 169 174 | 175  |
| 73939133   | ï½10G | 6400% | 40      | 512 529 | 529  |
| 1073807359 | ï½13G | 6400% | 26      | 165 169 | 170  |
| 2000000011 | ï½17G | 6400% | 30      | 171 176 | 176  |
|            |       |       |         |         |      |

å¥½å•Šï¼Œæ²¡å•¥ç”¨æ„Ÿè§‰ï¼Œæ¯•ç«Ÿ1e9+7çš„æ—¶å€™å°±æœ‰80%å·¦å³çš„å…ƒç´ hashæ˜¯æ²¡æœ‰å†²çªçš„ï¼Œç„¶å10%åªå†²çªä¸€æ¬¡ï¼Œä»¥æ­¤ç±»æ¨ã€‚

ç„¶ååšgetPositionä¹‹å‰å…¶å®å¯ä»¥æ ¹æ®åŸæ¥ä»£ç çš„é€»è¾‘å…ˆå¯¹umiåšä¸€ä¸‹filterï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡é‚£ä¹ˆgetPositionä¹Ÿå¯ä»¥ç›´æ¥ä¸åšäº†ã€‚æ·¦ä»–è¦ç»Ÿè®¡mMapToSlideReadè¿™å˜é‡ï¼Œï¼Œï¼Œï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¸èƒ½ç”¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚GG

|                                             |      |               | producer(pugz) | comsumer(pigz) | total |
| ------------------------------------------- | ---- | ------------- | -------------- | -------------- | ----- |
| no more disk write and readï¼Œpugz 1ï¼Œpigz 4 | ~60G | ï½5000%/6400% | 183 95 100     | 187 189        | 190   |
| ğŸ‘† use 1073807359                            | ~60G | ï½5000%/6400% | 180 85 91      | 183 183        | 185   |
|                                             |      |               |                |                |       |
|                                             |      |               |                |                |       |
|                                             |      |               |                |                |       |

//TODO æŠŠbarcodeç¼©ä¸€ä¸‹èŒƒå›´ç›´æ¥æä¸ªæ•°ç»„æ¥æµ‹æµ‹è·‘å¤šä¹…ã€‚

æ™šä¸Šè·‘å®Œæ­¥çªç„¶å¬åˆ°å¤§å¸ˆå…„é—®çº¿ç¨‹åŠ é€Ÿæ¯”å’‹æ ·ï¼Œemmmå¥½é—®é¢˜ã€‚

ç®€å•æµ‹æµ‹

|                          |      |        | getmap/producer | comsumer | total |
| ------------------------ | ---- | ------ | --------------- | -------- | ----- |
| in fqï¼Œout fqï¼Œthread 64 | 14G  | 6400%  | 26/165          | 170      | 170   |
| in fqï¼Œout fqï¼Œthread 32 | 13G  | 3200%+ | 29/201          | 206      | 200   |
| in fqï¼Œout fqï¼Œthread 16 | 12G  | 1600%+ | 26/315          | 323      | 324   |
| in fqï¼Œout fqï¼Œthread 8  | 11G  | 800%+  | 26/582          | 597      | 590   |
| in fqï¼Œout fqï¼Œthread 4  | 11G  | 400%+  | 26/1146         | 1175     | 1150  |
| in fqï¼Œout fqï¼Œthread 2  |      |        | 30/2323         | 2384     | 2384  |
| in fqï¼Œout fqï¼Œthread 1  |      |        | 29/4046         | 4149     | 4149  |

æŒ‰ç…§ä¹‹å‰qcä½¿ç”¨c++ threadåº“å®ç°P-Cæ¨¡å‹çš„ç»éªŒæ¥çœ‹ï¼Œä¸€èˆ¬åªè¦cpuè·‘èµ·æ¥äº†ä¸¤å€çš„çº¿ç¨‹ï¼Œé€Ÿåº¦å°±æ˜¯ä¸¤å€ï¼Œä½†ç°åœ¨çº¿ç¨‹åŠ é€Ÿæ¯”ä¸å¤Ÿå¥½ï¼Œåˆæ­¥çŒœæµ‹æ˜¯ä¼ªå…±äº«æˆ–è€…remote numaè®¿å­˜æ•ˆç‡ä½çš„åŸå› ï¼Œå¯¹äºnumaæ¶æ„ç®€å•å­¦ä¹ äº†ä¸€ä¸‹ï¼š

https://zhuanlan.zhihu.com/p/62795773

ç®€å•è¯´å°±æ˜¯æé«˜è®¿é—®å†…å­˜çš„æ•ˆç‡ï¼Œâ¬†ï¸æ–‡ä¸­æåˆ°äº†å†…å­˜éœ€æ±‚å¾ˆå¤§ï¼Œè¶…è¿‡ä¸€ä¸ªnumaèŠ‚ç‚¹å¯¹åº”å†…å­˜çš„æ—¶å€™é¢‘ç¹swapå¸¦æ¥é—®é¢˜ï¼Œç°åœ¨ä»£ç é‡Œé¢çš„æƒ…å†µåº”è¯¥ç•¥æœ‰ä¸åŒï¼Œæ˜¯ä¸¤ä¸ªnumaèŠ‚ç‚¹çš„coreéƒ½ç”¨èµ·æ¥äº†ï¼Œä½†æ˜¯å­˜å‚¨å…³é”®ä¿¡æ¯çš„hashmapåªåœ¨æŸä¸ªèŠ‚ç‚¹çš„å†…å­˜ä¸Šï¼Œè¿™æ ·æœ‰ä¸€åŠcoreåœ¨è®¿å­˜çš„æ—¶å€™ä¼šæ¯”è¾ƒæ…¢ã€‚ç®€å•æƒ³åˆ°çš„è§£å†³åŠæ³•å°±æ˜¯åœ¨å¦ä¸ªnumaèŠ‚ç‚¹å¯¹åº”çš„å†…å­˜é‡Œå¼€ä¸€ä¸ªhashmapçš„å‰¯æœ¬ï¼Œé‚£ä¸ªèŠ‚ç‚¹è®¿é—®è‡ªå·±çš„mapã€‚

ç¼–è¯‘äº†ä¸ªè½¯ä»¶çœ‹äº†çœ‹compute006çš„numaæ¶æ„ï¼š

![server](/Users/ylf9811/Downloads/server.png)

## 0922

æŠŠpostionæ¢ä¸€ä¸‹

## 0923

æ²¡æ¢å®Œï¼Œæµ‹ä¸€ä¸‹no outï¼Œin fqï¼Œonly socket0

|           | getmap | producer/comsumer      | total |      |
| --------- | ------ | ---------------------- | ----- | ---- |
| thread 32 | 30     | 187/192-30=157/162     | 192   |      |
| thread 16 | 27     | 275/282-27=248/255     | 282   |      |
| thread 8  | 26     | 490/503-26=464/477     | 503   |      |
| thread 4  | 26     | 942/966-26=916/940     | 966   |      |
| thread 2  | 27     | 1841/1889-27=1814/1862 | 1889  |      |
| thread 1  | 27     | 3648/3742-27=3621/3715 | 3742  |      |



|           | getmap | producer/comsumer      | total |      |
| --------- | ------ | ---------------------- | ----- | ---- |
| thread 32 | 27     | 196/201-27=169/174     | 201   |      |
| thread 16 | 27     | 313/321-27=286/294     | 321   |      |
| thread 8  | 27     | 567/582-27=540/555     | 582   |      |
| thread 4  | 27     | 1092/1120-27=1065/1093 | 1120  |      |
| thread 2  | 31     | 2384/2449-31=2353/2418 | 2449  |      |
| thread 1  |        |                        |       |      |



çƒ¦å“¦ï¼Œè¿™è¿è¡Œæ€ä¹ˆå¿½å¿«å¿½æ…¢çš„ã€‚

pac

|                                     | get map | producer | consumer | total | time |
| ----------------------------------- | ------- | -------- | -------- | ----- | ---- |
| ./yrun.sh 64                        | 27      | 144      | 149      | 177   | 3m8  |
|                                     | 27      | 148      | 153      | 180   | 3m9  |
|                                     | 26      | 144      | 150      | 178   | 3m6  |
|                                     | 27      | 144      | 148      | 176   | 3m4  |
| ./yrun.sh 64 remove Positon         | 28      | 140      | 145      | 175   | 3m4  |
|                                     | 27      | 151      | 156      | 184   | 3m10 |
|                                     | 27      | 141      | 145      | 173   | 3m0  |
|                                     | 29      | 152      | 157      | 187   | 3m16 |
|                                     |         |          |          |       |      |
| ./yrun.sh 32                        | 26      | 171      | 177      | 203   | 3m28 |
|                                     | 27      | 169      | 174      | 201   | 3m29 |
|                                     | 27      | 171      | 176      | 204   | 3m32 |
|                                     | 26      | 173      | 178      | 207   | 3m29 |
|                                     |         |          |          |       |      |
| ./yrun.sh 32 remove Positon         | 21      | 152      | 157      | 178   |      |
|                                     | 21      | 153      | 158      | 180   |      |
|                                     | 21      | 150      | 155      | 176   |      |
|                                     | 21      | 151      | 155      | 177   |      |
|                                     | 21      | 153      | 158      | 179   |      |
|                                     | 21      | 143      | 148      | 169   |      |
|                                     |         |          |          |       |      |
| ./yrun.sh 32 remove Positon socket0 | 22      | 144      | 149      | 171   |      |
|                                     | 22      | 143      | 148      | 170   |      |
|                                     | 21      | 144      | 160      | 182   |      |
|                                     | 22      | 144      | 148      | 170   |      |
|                                     | 21      | 144      | 148      | 169   |      |
|                                     | 21      | 144      | 148      | 170   |      |
|                                     |         |          |          |       |      |
| ./yrun.sh 16                        | 26      | 293      | 301      | 329   | 5m30 |
|                                     | 28      | 287      | 295      | 327   | 5m28 |
|                                     | 28      | 288      | 296      | 324   | 5m27 |
|                                     | 26      | 288      | 296      | 323   | 5m28 |
|                                     |         |          |          |       |      |
| ./yrun.sh 16 remove Positon         |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
| /yrun.sh 16 remove Positon socket0  | 21      | 223      | 229      | 251   |      |
|                                     | 21      | 223      | 230      | 252   |      |
|                                     | 21      | 223      | 229      | 251   |      |
|                                     | 22      | 223      | 229      | 251   |      |
|                                     | 21      | 223      | 229      | 250   |      |
|                                     |         |          |          |       |      |
| ./yrun.sh 8 remove Positon          |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
| ./yrun.sh 8 remove Positon socket0  | 22      | 395      | 406      | 428   |      |
|                                     | 21      | 394      | 405      | 427   |      |
|                                     | 21      | 394      | 405      | 426   |      |
|                                     | 22      | 394      | 405      | 427   |      |
|                                     | 21      | 394      | 404      | 427   |      |
|                                     |         |          |          |       |      |
| ./yrun.sh 4 remove Positon          |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
| ./yrun.sh 4 remove Positon socket0  | 21      | 748      | 768      | 790   |      |
|                                     | 21      | 752      | 772      | 794   |      |
|                                     | 21      | 747      | 767      | 789   |      |
|                                     | 21      | 750      | 770      | 792   |      |
|                                     | 21      | 751      | 770      | 792   |      |
|                                     |         |          |          |       |      |
| ./yrun.sh 2 remove Positon          |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
|                                     |         |          |          |       |      |
| ./yrun.sh 2 remove Positon socket0  | 21      | 1463     | 1502     | 1523  |      |
|                                     | 22      | 1466     | 1504     | 1526  |      |
|                                     |         |          |          |       |      |

fat

|              | get map | producer | consumer | total | time  |
| ------------ | ------- | -------- | -------- | ----- | ----- |
| ./yrun.sh 40 | 40      | 174      | 180      | 220   | 3m40s |
|              | 34      | 169      | 175      | 210   | 3m31  |
|              | 35      | 169      | 174      | 209   | 3m29  |
|              | 33      | 170      | 176      | 209   | 3m30  |
|              |         |          |          | 210   |       |
|              |         |          |          | 214   |       |
|              |         |          |          |       |       |
| ./yrun.sh 20 | 34      | 317      | 327      | 363   | 6m2   |
|              | 34      | 314      | 323      | 357   | 5m58  |
|              | 36      | 319      | 329      | 366   | 6m6   |
|              | 35      | 322      | 331      | 367   | 6m7   |
|              | 34      | 298      | 307      | 341   | 5m42  |
|              | 33      | 306      | 315      | 349   | 5m49  |
|              |         |          |          | 352   |       |
| ./yrun.sh 10 |         |          |          |       |       |
|              |         |          |          |       |       |
|              |         |          |          |       |       |
|              |         |          |          |       |       |
|              |         |          |          |       |       |

```
rm -rf combine_read.fq && sleep 10 && time ../ST_BarcodeMap-0.0.1 --in DP8400016231TR_D1.barcodeToPos.h5 --in1 p1.fq --in2 p2.fq --out combine_read.fq --mismatch 2 --thread 32
```

## 0924 0925

ä¸€ç›´åœ¨åšæµ‹è¯•

å‘ç°äº†æƒŠå¤©å¤§ç§˜å¯†ï¼Œ006å’Œ003è¿è¡Œçš„ä¸ä¸€æ ·å¿«ï¼Œ003è¦å¿«ä¸€äº›ã€‚

|                                     | get map | producer | consumer | total | time         |
| ----------------------------------- | ------- | -------- | -------- | ----- | ------------ |
| ./yrun.sh 64 remove Positon         | 21      | 145      | 150      | 171   |              |
|                                     | 22      | 128      | 133      | 155   |              |
|                                     | 21      | 142      | 147      | 169   |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 32 remove Positon         | 21      | 152      | 157      | 178   |              |
|                                     | 21      | 153      | 158      | 180   |              |
|                                     | 21      | 150      | 155      | 176   |              |
|                                     | 21      | 151      | 155      | 177   |              |
|                                     | 21      | 153      | 158      | 179   |              |
|                                     | 21      | 158      | 163      | 184   |              |
|                                     | 22      | 155      | 159      | 182   |              |
|                                     | 21      | 157      | 162      | 184   |              |
|                                     | 21      | 151      | 156      | 177   |              |
|                                     | 21      | 152      | 165      | 187   | 180*1.5=270  |
|                                     |         |          |          |       |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 32 remove Positon socket0 | 22      | 144      | 149      | 171   |              |
|                                     | 22      | 143      | 148      | 170   |              |
|                                     | 21      | 144      | 160      | 182   |              |
|                                     | 22      | 144      | 148      | 170   |              |
|                                     | 21      | 144      | 148      | 169   |              |
|                                     | 21      | 144      | 148      | 170   |              |
|                                     | 21      | 143      | 148      | 169   |              |
|                                     | 21      | 144      | 148      | 171   |              |
|                                     | 21      | 143      | 148      | 170   |              |
|                                     | 21      | 144      | 148      | 178   |              |
|                                     | 21      | 144      | 148      | 170   |              |
|                                     | 21      | 143      | 148      | 170   | 170*1.47=250 |
|                                     |         |          |          |       |              |
| ./yrun.sh 16 remove Positon         | 22      | 242      | 249      | 271   |              |
|                                     | 21      | 241      | 248      | 270   |              |
|                                     | 21      | 243      | 250      | 271   |              |
|                                     | 21      | 242      | 249      | 271   |              |
|                                     | 21      | 243      | 249      | 271   | 270*1.81=490 |
|                                     |         |          |          |       |              |
| /yrun.sh 16 remove Positon socket0  | 21      | 223      | 229      | 251   |              |
|                                     | 21      | 223      | 230      | 252   |              |
|                                     | 21      | 223      | 229      | 251   |              |
|                                     | 22      | 223      | 229      | 251   |              |
|                                     | 21      | 223      | 229      | 250   |              |
|                                     | 21      | 223      | 230      | 251   |              |
|                                     | 21      | 223      | 230      | 251   |              |
|                                     | 21      | 223      | 230      | 251   |              |
|                                     | 21      | 223      | 230      | 256   |              |
|                                     | 21      | 223      | 230      | 252   | 252*1.69=427 |
|                                     |         |          |          |       |              |
| ./yrun.sh 8 remove Positon          | 22      | 453      | 465      | 488   |              |
|                                     | 21      | 456      | 469      | 490   |              |
|                                     | 21      | 456      | 468      | 490   |              |
|                                     | 21      | 456      | 468      | 490   |              |
|                                     | 21      | 454      | 466      | 487   |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 8 remove Positon socket0  | 22      | 395      | 406      | 428   |              |
|                                     | 21      | 394      | 405      | 427   |              |
|                                     | 21      | 394      | 405      | 426   |              |
|                                     | 22      | 394      | 405      | 427   |              |
|                                     | 21      | 394      | 404      | 427   |              |
|                                     | 21      | 394      | 405      | 427   |              |
|                                     | 21      | 394      | 405      | 427   |              |
|                                     | 21      | 395      | 405      | 427   |              |
|                                     | 21      | 394      | 405      | 426   |              |
|                                     | 21      | 394      | 405      | 426   |              |
|                                     |         |          |          |       |              |
|                                     |         |          |          |       |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 4 remove Positon          | 21      | 884      | 907      | 929   |              |
|                                     | 21      | 886      | 910      | 932   |              |
|                                     | 21      | 889      | 913      | 935   |              |
|                                     | 21      | 884      | 908      | 930   |              |
|                                     | 21      | 886      | 910      | 932   |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 4 remove Positon socket0  | 21      | 748      | 768      | 790   |              |
|                                     | 21      | 752      | 772      | 794   |              |
|                                     | 21      | 747      | 767      | 789   |              |
|                                     | 21      | 750      | 770      | 792   |              |
|                                     | 21      | 751      | 770      | 792   |              |
|                                     | 21      | 750      | 770      | 791   |              |
|                                     | 21      | 750      | 770      | 791   |              |
|                                     | 21      | 750      | 770      | 791   |              |
|                                     | 21      | 750      | 770      | 792   |              |
|                                     | 21      | 750      | 770      | 791   |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 2 remove Positon          | 21      | 1758     | 1804     | 1825  |              |
|                                     | 21      | 1756     | 1802     | 1824  |              |
|                                     |         |          |          |       |              |
|                                     |         |          |          |       |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 2 remove Positon socket0  | 21      | 1463     | 1502     | 1523  |              |
|                                     | 22      | 1466     | 1504     | 1526  |              |
|                                     | 21      | 1467     | 1505     | 1527  |              |
|                                     | 21      | 1459     | 1497     | 1518  |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 1 remove Positon          | 21      | 3033     | 3109     | 3131  |              |
|                                     |         |          |          |       |              |
| ./yrun.sh 1 remove Positon socket0  | 21      | 2887     | 2962     | 2984  |              |
|                                     |         |          |          |       |              |

## 0926

update ğŸ‘†

ç»è¿‡ç®€å•çš„æµ‹è¯•ï¼ŒæŒ‡å®šå•ä¸ªnumaèŠ‚ç‚¹æ•ˆæœè¦å¥½ä¸€ç‚¹ï¼Œ003æ¯”006è¦å¥½ä¸€ç‚¹ï¼Œç”¨Positionè¿˜æ˜¯int32ï¼ŒåŒºåˆ«ä¸å¤§ï¼Œæš‚æ—¶éƒ½ç”¨int32çš„ç‰ˆæœ¬ã€‚

å¥½å•Šï¼Œç»è¿‡ç®€å•çš„æµ‹è¯•ï¼Œè™½ç„¶å¤§å¸ˆå…„è¯´çš„çº¿ç¨‹åŠ é€Ÿæ¯”æ²¡æœ‰çœ‹å‡ºä»€ä¹ˆçŒ«è…»æ¥ï¼Œä½†æ˜¯ç¡®å®å•ä¸ªnumaèŠ‚ç‚¹è¦å¥½ä¸€äº›ï¼Œç°åœ¨æä¸€ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªnumaèŠ‚ç‚¹æœ‰è‡ªå·±çš„mapå‰¯æœ¬ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨è¿œç¨‹numaè®¿é—®çš„é—®é¢˜äº†ã€‚

ç®€å•è¯•è¯•ï¼Œå°±æ˜¯åŒæ—¶è·‘ä¸¤ä¸ªç¨‹åºï¼Œæ¯æ¬¡32ä¸ªçº¿ç¨‹ï¼Œè·‘åœ¨ä¸åŒçš„numaèŠ‚ç‚¹ä¸Šï¼›å…·ä½“çš„ï¼Œä¸¤ä¸ªç¨‹åºä¼ ä¸€ä¸ªå‚æ•°--socketIdï¼Œ0æˆ–è€…1ï¼Œç„¶åç”Ÿäº§è€…åªæŠŠå¯¹åº”çš„å—è¯»è¿›æ¥æ”¾åˆ°é˜Ÿåˆ—é‡Œé¢äº¤ç»™æ¶ˆè´¹è€…å¤„ç†ï¼Œå†™å°±æš‚æ—¶åˆ†åˆ«å†™ä¸¤ä¸ªæ–‡ä»¶ã€‚

|                                                | get map | producer                | consumer                      | total   | time |
| ---------------------------------------------- | ------- | ----------------------- | ----------------------------- | ------- | ---- |
| socket0 32 half data                           | 21      | 71                      | 75                            | 97      |      |
|                                                | 21      | 71                      | 75                            | 97      |      |
|                                                | 21      | 71                      | 75                            | 97      |      |
| socket1 32 half data                           | 21      | 70                      | 74                            | 96      |      |
|                                                |         |                         |                               |         |      |
|                                                |         |                         |                               |         |      |
| merge ğŸ‘†                                        | 21/21   | 71/71                   | 75/75                         | 97/96   |      |
|                                                |         |                         |                               |         |      |
|                                                |         |                         |                               |         |      |
| in gzï¼Œout gz thread 64-1-4                    | 22      | 136 93/99               | 138/147                       | 169     |      |
|                                                |         |                         |                               |         |      |
| in gzï¼Œout gz thread 32-1-4  socket0 half data | 21      | 87 62/67                | 87/87                         | 109     |      |
|                                                |         |                         |                               |         |      |
| in gzï¼Œout gz thread 32-1-4  socket1 half data | 21      | 87 62/67                | 87/87                         | 109     |      |
|                                                |         |                         |                               |         |      |
| mpirun -n 1, in fq, out fq, thread 64          | 22      | 147                     | 152                           | 183     |      |
|                                                | 22      | 137                     | 142                           | 164     |      |
|                                                | 21      | 139                     | 144                           | 171     |      |
| mpirun -n 2, in fq, out fq, thread 32          | 22/22   | 68/68                   | 72/72(write:72/87)            | 95/110  |      |
|                                                | 22/22   | 68/68                   | 72/72(write:72/73)            | 94/95   |      |
| mpirun -n 2, in gz, out gz, thread 32          | 22/22   | 79/79(pugz:79/79 83/83) | 82/83(write:82/83 pigz:84/84) | 107/107 |      |
|                                                |         |                         |                               | 107/107 |      |
|                                                |         |                         |                               | 109/109 |      |
|                                                |         |                         |                               |         |      |

## 0928

è¯•äº†è¯•å¿«é€Ÿmodï¼Œæ²¡ä»€ä¹ˆç”¨ï¼Œæ™šä¸Šå°è¯•åŠ å¸ƒéš†è¿‡æ»¤å™¨ã€‚

|                     | get map/bloom | producer | consumer | total |
| ------------------- | ------------- | -------- | -------- | ----- |
| thread 64ï¼Œno mpiï¼Œ | 26            | 143      | 148      | 175   |
|                     | 26            | 139      | 143      | 169   |
|                     | 25            | 142      | 146      | 173   |
| thread 64ï¼Œ4 hash   | 35            | 194      | 201      | 237   |
| thread 64ï¼Œ1 hash   | 30            |          |          | 193   |

```
1 hash
total_query_cnt:	156371927497
after_filter_query_cnt:	144998762505

4 hash
total_query_cnt:	156371927497
after_filter_query_cnt:	156099493240

total_query_cnt:	156377424777
after_filter_query_cnt:	2431340523
find_query_cnt:	145470356

new wang hash
total_query_cnt:	156377424777
after_filter_query_cnt:	917789027
find_query_cnt:	145470356

```

## 0930

å¥½å•Šï¼Œä»Šå¤©å¿…é¡»è¦å‡ºç‚¹æ´»äº†ï¼Œç°åœ¨çš„æƒ…å†µæ˜¯ç®€å•è¯•äº†bloomfilterï¼Œç¡®å®èƒ½æŠŠ99%çš„æŸ¥è¯¢çš„ç­›æ‰ï¼Œä½†æ˜¯ç”¨äº†ä¸‰ä¸ªhashå‡½æ•°ï¼Œå¹¶ä¸”æ˜¯stlçš„bitsetä½œä¸ºæ•°æ®ç»“æ„å¯èƒ½éƒ½ä¸å¤ªé«˜æ•ˆï¼Œå‡†å¤‡æ›¿æ¢æˆæ‰‹å†™è¯•è¯•ã€‚

æ­¤å¤–ï¼Œä¸ºäº†æ›´å¥½çš„è¯„ä»·æ¯ä¸ªç‰ˆæœ¬çš„æ€§èƒ½æŒ‡æ ‡ï¼Œéœ€è¦å¯¹å„ä¸ªæ¨¡å—è®¡æ—¶ï¼Œç›®å‰çš„ç­–ç•¥æ˜¯æŠŠåŸæ¥é€»è¾‘é‡Œé¢çš„breakéƒ½å¹²æ‰ï¼Œç„¶åé€šè¿‡æ³¨é‡Šbloomfilterçš„ä»£ç æ¥è¯„ä»·æ—¶é—´ã€‚

å¥½å•Šï¼Œç°åœ¨æŠŠmisoverlapéƒ¨åˆ†çš„breakæ³¨é‡Šï¼Œæµ‹æµ‹æ—¶é—´å’ŒæŸ¥è¯¢æ¬¡æ•°ï¼š

```
no misoverlap break
total_query_cnt:        157473409122
after_filter_query_cnt: 1010068985
find_query_cnt: 233394250


```

è¿™æ ·æµ‹æ²¡å•¥ç”¨å•Šæ„Ÿè§‰ï¼Œä¸»è¦è¿˜æ˜¯æµ‹bfå å¤šå°‘æ—¶é—´ï¼Œæ”¹æ”¹ç­–ç•¥ï¼Œä¸€ä¸ªç‰ˆæœ¬ä¸åšbfï¼Œå¦ä¸€ä¸ªåšbfä½†æ˜¯ä¸ç”¨ä»–çš„ç»“æœã€‚

```
åšbfï¼š
42+197


ä¸åšbfï¼š
41+78

```



å¥½å•Šï¼Œç°åœ¨æ‰‹å†™ä¸€ä¸ªbloomfilterï¼Œç”¨uint64*æ¥ä½œä¸ºæ•°æ®ç»“æ„å­˜å‚¨ï¼Œå› ä¸ºå¾ˆå¤šhashå‡½æ•°éƒ½æ˜¯uint64        -> uint32ä¹‹ç±»çš„ï¼Œæ‰€ä»¥å­˜å‚¨çš„è¯bitæ•°å¤§çº¦æ˜¯1<<32ï¼Œä¹Ÿå°±æ˜¯1<<26è¿™ä¹ˆå¤§çš„uint64æ•°ç»„ï¼Œç„¶åæŸ¥è¯¢keyçš„æ—¶å€™è¦å¯¹åº”è½¬åŒ–ä¸ºã€‚ã€‚ã€‚

è¯•è¿‡äº†æ²¡å•¥ç”¨ã€‚

ç¡®å®èƒ½è¿‡æ»¤å¾ˆå¤šå¾ˆå¤šï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¿«ï¼Œç”šè‡³æ…¢äº†10sï¼ˆ110--120ï¼‰

ç„¶åè¯•äº†è¯•æŠŠåŸæ¥çš„hashmapæ¢ä¸€ç§hashæ–¹å¼ï¼Œæ²¡å•¥ç”¨ï¼›è¯•äº†è¯•ç›´æ¥æŠŠhashæ•°ç»„å¼€å¤§4å€ï¼Œæ²¡å•¥ç”¨ã€‚

ç„¶åè¯•è¯•äºŒçº§ç´¢å¼•ã€å†…å­˜å°ä¸€ç‚¹çš„bfã€æŒ‘0ï¼Œ3ï¼Œ6ï¼Œ9ã€‚ã€‚ã€‚ä½åšç­›é€‰ã€

## 1003

01 02æ”¾å‡æ‘¸é±¼ã€‚

å‚æ­»ç—…ä¸­æƒŠåèµ·ï¼Œæ²¡æœ‰ç”¨æœ€æ–°çš„rabbitioï¼Œç”¨çš„æ˜¯rabbitqcä¸­çš„ï¼Œæœç„¶è‡ªå·±æŒ–çš„å‘ã€‚ã€‚ã€‚ã€‚

|                  | getmap | tot  | tot-getmap |
| ---------------- | ------ | ---- | ---------- |
| no processï¼Œ32*2 | 28     | 45   | 17         |
| no processï¼Œ64*1 | 28     | 61   | 33         |
| no processï¼Œ32*1 | 28     | 67   | 39         |
| ReRabbitQCï¼Œ48   | /      |      | 31         |
| RabbitQCï¼Œ48     |        |      | 31         |
| no processï¼Œ32*2 | 21     | 64   | 42         |

å˜¶ï¼Œæµ‹äº†æµ‹æ„Ÿè§‰å¤šçš„æ‹·è´ä¹Ÿæ²¡å•¥å½±å“å•Šã€‚å…ˆå†™å†™mpiåˆå¹¶è¾“å‡ºçš„ç‰ˆæœ¬å§ã€‚

## 1004

ğŸ‘†è¯´çš„ç‰ˆæœ¬ï¼Œæ”¹ä¹‹å‰æ—¶é—´å¤§çº¦24/28-111ã€25/28-109

æ”¹ä¹‹åsizeä¸å¤ªå¯¹emmmï¼Œæ—¶é—´å¤§çº¦25/28-116ã€25/28-118ã€24/27-118

æ·¦ï¼Œä»–sizeåˆå¯¹äº†ï¼Ÿï¼Ÿä¸Šåˆä¸Šè¯¾çš„æ—¶å€™ç—´å‘†äº†ï¼Ÿè¿˜æ˜¯é”™è¯¯æµ®ç°ä¸å‡ºæ¥äº†ï¼Ÿ

//TODO//TODO//TODO//TODO//TODO

ç”¨rabbitqcçœ‹ä¸€çœ‹è¾“å‡ºçš„ç»“æœï¼Œ

STDï¼š<img src="/Users/ylf9811/Library/Application Support/typora-user-images/image-20211004190937957.png" alt="image-20211004190937957" style="zoom:50%;" />

nowï¼š<img src="/Users/ylf9811/Library/Application Support/typora-user-images/image-20211004191001061.png" alt="image-20211004191001061" style="zoom:50%;" />

å¥½åƒçœŸçš„å¤ç°ä¸å‡ºæ¥äº†ã€‚ã€‚ã€‚ã€‚ã€‚

æš‚æ—¶å…ˆæŠŠé‡ç‚¹æ”¾åœ¨bfä¸Šå§ã€‚

ä¸€ä¸ªnumaèŠ‚ç‚¹ï¼š28-177ã€28-179ã€

in and out in shmã€one numa nodeï¼š28-170

è€ç”˜ç»™çš„é“¾æ¥é‡Œæœ‰å¥½å‡ ä¸ªmapï¼Œç®€å•å†™ä¸ªæµ‹è¯•æ€§èƒ½çš„ç©æ„ï¼š

```

#include <iostream>
#include <sparsehash/dense_hash_map>
#include <cstring>
#include <algorithm>
#include <sys/time.h>
#include <vector>
#include <random>
#include <unordered_map>

#define mm long long
//#define mm int

using google::dense_hash_map;      // namespace where class lives by default
using std::cout;
using std::endl;
using std::tr1::hash;  // or __gnu_cxx::hash, or maybe tr1::hash, depending on your OS
static const int mod = 1073807359;


double MainGetTime() {
    struct timeval tv;
    gettimeofday(&tv, NULL);
    return (double) tv.tv_sec + (double) tv.tv_usec / 1000000;
}

typedef struct node {
    int pre;
    mm v;
    int pos;
} node;


int main() {
    double t0 = MainGetTime();


    std::random_device rd;
    std::mt19937_64 gen(rd());

    std::uniform_int_distribution<mm> dis;


    std::vector<mm> G;
    std::vector<mm> P;
    int id;
    int cnt;
    int M = 2e8;
    int N = 1e9;

    for (int i = 0; i < M; i++) {
        G.push_back(dis(gen));
    }
    for (int i = 0; i < N; i++) {
        P.push_back(dis(gen));
    }
    printf("init cost %lf\n", MainGetTime() - t0);


    t0 = MainGetTime();
    dense_hash_map<mm, int> mps;

    mps.set_empty_key(NULL);
    id = 0;
    for (auto it:G) {
        id++;
        mps[it] = id;
    }
    printf("dense_hash_map insert cost %lf\n", MainGetTime() - t0);

    t0 = MainGetTime();
    cnt = 0;
    for (auto it:P) {
        if (mps.count(it))cnt++;
    }
    printf("dense_hash_map find %d\n", cnt);
    printf("dense_hash_map find cost %lf\n", MainGetTime() - t0);


    t0 = MainGetTime();
    id = 0;

    int *hashHead = new int[mod + 10];
    for (int i = 0; i < mod; i++)hashHead[i] = -1;
    node *hashMap = new node[M + 10];
    int hashNum = 0;
    for (auto it:G) {
        id++;
        int key = it % mod;
        int ok = 0;
        for (int i = hashHead[key]; i != -1; i = hashMap[i].pre)
            if (hashMap[i].v == it) {
                hashMap[i].pos = id;
                ok = 1;
                break;
            }
        if (ok == 0) {
            hashMap[hashNum].v = it;
            hashMap[hashNum].pos = id;
            hashMap[hashNum].pre = hashHead[key];
            hashHead[key] = hashNum;
            hashNum++;
        }
    }
    printf("gogo insert cost %lf\n", MainGetTime() - t0);
    t0 = MainGetTime();
    cnt = 0;
    for (auto it:P) {
        int ok = 0;
        int pos = -1;
        int key = it % mod;
        for (int i = hashHead[key]; i != -1; i = hashMap[i].pre) {
            if (hashMap[i].v == it) {
                pos = hashMap[i].pos;
                ok = 1;
                break;
            }
        }
        if (ok)cnt++;
    }
    printf("gogo find %d\n", cnt);
    printf("gogo find cost %lf\n", MainGetTime() - t0);

    t0 = MainGetTime();
    std::unordered_map<mm, int> mp2s;
    id = 0;
    for (auto it:G) {
        id++;
        mp2s[it] = id;
    }
    printf("stl unordered_map insert cost %lf\n", MainGetTime() - t0);


    t0 = MainGetTime();
    cnt = 0;
    for (auto it:P) {
        if (mp2s.count(it))cnt++;
    }
    printf("stl unordered_map find %d\n", cnt);
    printf("stl unordered_map find cost %lf\n", MainGetTime() - t0);

}

M=2e8 N=1e9 thread=1

[PAC20217111@compute003 ylf]$ ./hashTest
init cost 27.841362
dense_hash_map insert cost 18.319946
dense_hash_map find 166
dense_hash_map find cost 30.111485
gogo insert cost 7.738144
gogo find 166
gogo find cost 25.507501
stl unordered_map insert cost 70.406113
stl unordered_map find 166
stl unordered_map find cost 55.771334

ğŸ‘† use find not count
[PAC20217111@compute003 ylf]$ ./hashTest
init cost 28.364878
dense_hash_map insert cost 15.537160
dense_hash_map find 174
dense_hash_map find cost 37.527437
sparse_hash_map insert cost 116.459556
sparse_hash_map find 174
sparse_hash_map find cost 175.995829
gogo insert cost 7.135087
gogo find 174
gogo find cost 24.261454
stl unordered_map insert cost 73.188713
stl unordered_map find 174
stl unordered_map find cost 61.126728


M=6e7 N=1e9 thread=1
[PAC20217111@compute003 ylf]$ ./hashTest
init cost 22.414524
dense_hash_map insert cost 4.985887
dense_hash_map find 55
dense_hash_map find cost 34.944564
sparse_hash_map insert cost 34.306814
sparse_hash_map find 55
sparse_hash_map find cost 53.169762
gogo insert cost 2.976034
gogo find 55
gogo find cost 21.728029
stl unordered_map insert cost 18.886106
stl unordered_map find 55
stl unordered_map find cost 63.939711

[PAC20217111@compute003 ylf]$ time ./hashTest
init cost 24.635170
google::dense_hash_map insert cost 4.901080
google::dense_hash_map find 63
google::dense_hash_map find cost 35.008083
google::sparse_hash_map insert cost 33.590294
google::sparse_hash_map find 63
google::sparse_hash_map find cost 51.789670
spp::sparse_hash_map insert cost 17.595097
spp::sparse_hash_map find 63
spp::sparse_hash_map find cost 43.207952
gogo insert cost 2.930788
gogo find 63
gogo find cost 21.738789
stl unordered_map insert cost 20.002673
stl unordered_map find 63
stl unordered_map find cost 64.700771


M=2e8 N=1e9 thread=32

[PAC20217111@compute003 ylf]$ ./hashTest
init cost 26.854261
dense_hash_map insert cost 18.031583
dense_hash_map find 182
dense_hash_map find cost 2.938416
gogo insert cost 7.980589
gogo find 182
gogo find cost 2.200198
stl unordered_map insert cost 69.550551
stl unordered_map find 182
stl unordered_map find cost 3.741968


M=2e8 N=1e10 thread=32
[PAC20217111@compute003 ylf]$ ./hashTest
init cost 319.879172
dense_hash_map insert cost 23.582168
dense_hash_map find 1639
dense_hash_map find cost 18.351356
gogo insert cost 7.843452
gogo find 1639
gogo find cost 14.136651
stl unordered_map insert cost 82.213892
stl unordered_map find 1639
stl unordered_map find cost 29.233407


M=2e8 N=1e9 thread=32
[PAC20217111@compute003 ylf]$ ./hashTest
init cost 7.282487
dense_hash_map insert cost 11.859019
dense_hash_map find 95475949
dense_hash_map find cost 2.299639
sparse_hash_map insert cost 74.191624
sparse_hash_map find 95475949
sparse_hash_map find cost 6.081009
gogo insert cost 4.767718
gogo find 95475949
gogo find cost 1.383346
stl unordered_map insert cost 68.503956
stl unordered_map find 95475949
stl unordered_map find cost 3.647662

```

## 1005

å˜¶ï¼Œæ²¡å•¥ç”¨å“ï¼Œæ„Ÿè§‰æ‰‹å†™çš„hashmapåº”è¯¥å°±æ˜¯æœ€å¿«çš„äº†ï¼Œè¿˜æ˜¯å›åˆ°bfä¸Šå¼„å¼„ã€‚

æ‰¾åˆ°ä¹‹å‰ä¸¤ä¸ªè¿›ç¨‹mergeè¾“å‡ºçš„é—®é¢˜äº†ï¼ŒåŸæ¥æ£€æµ‹æ˜¯å¦ç»“æŸæ˜¯p0çš„æ¶ˆè´¹è€…ç»“æŸäº†å°±setï¼Œå¯èƒ½p0çš„cä»¬ç»“æŸäº†ï¼Œæ°å¥½é˜Ÿåˆ—ç©ºäº†ï¼ˆp1çš„mergeThreadæ²¡æ¥åŠå¡æ•°æ®ï¼‰ï¼Œç„¶åæ²¡è¾“å‡ºå…¨ï¼Œç°åœ¨å¤šåŠ äº†ä¸ªflagå°±å¥½äº†ã€‚

